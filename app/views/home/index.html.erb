<div class="min-h-screen bg-gray-100">
  <!-- Navbar -->
  <nav class="bg-blue-600 text-white px-6 py-3 flex justify-between items-center">
    <h1 class="text-xl font-bold">Facebook</h1>
    <div class="flex items-center gap-4">
      <% if user_signed_in? %>
        <span class="text-sm"><%= current_user.email %></span>
        <%= link_to "New Post", new_post_path, class: "bg-white text-blue-600 px-3 py-1 rounded font-semibold" %>
        <%= link_to "Log out", destroy_user_session_path, method: :delete, class: "underline" %>
      <% else %>
        <%= link_to "Sign Up", new_user_registration_path, class: "underline" %>
        <%= link_to "Log In", new_user_session_path, class: "underline" %>
      <% end %>
    </div>
  </nav>

  <!-- Feed -->
  <div class="max-w-xl mx-auto mt-6 space-y-4">
    <% @posts.each do |post| %>
      <div class="bg-white p-4 rounded-lg shadow">
        <!-- Post header -->
        <div class="flex items-center gap-3">
          <!-- Avatar -->
          <div class="w-12 h-12 flex-shrink-0 rounded-full overflow-hidden">
            <% if post.user&.avatar&.attached? %>
              <%= image_tag post.user.avatar.variant(resize_to_fill: [48, 48]),
                class: "w-full h-full object-cover rounded-full" %>
            <% else %>
              <div class="w-full h-full bg-blue-500 text-white flex items-center justify-center font-bold">
                <%= post.user&.email ? post.user.email[0].upcase : "?" %>
              </div>
            <% end %>
          </div>

          <!-- User info -->
          <div class="flex flex-col ml-2">
            <p class="font-semibold text-sm"><%= post.user&.email || "Unknown" %></p>
            <p class="text-xs text-gray-500 ml-1"><%= time_ago_in_words(post.created_at) %> ago</p>
          </div>
        </div>

        <!-- Post body -->
        <p class="mt-4 text-sm"><%= post.body %></p>

        <!-- Likes -->
        <% if user_signed_in? %>
          <div class="mt-4 border-t pt-2 flex gap-4 text-sm text-gray-600">
            <span>üëç <%= post.likes.count %></span>

            <% if current_user.likes.exists?(post: post) %>
              <%= button_to "Unlike",
                post_like_path(post, post.likes.find_by(user: current_user)),
                method: :delete,
                class: "text-red-500" %>
            <% else %>
              <%= button_to "Like",
                post_likes_path(post),
                method: :post,
                class: "text-blue-600" %>
            <% end %>
          </div>
        <% else %>
          <div class="mt-4 border-t pt-2 text-sm text-gray-500">
            Log in to like posts.
          </div>
        <% end %>

        <!-- Comments -->
        <div class="mt-3 border-t pt-2">
          <% post.comments.each do |comment| %>
            <p class="text-sm mt-1">
              <strong><%= comment.user&.email || "Unknown" %></strong>: <%= comment.body %>
            </p>
          <% end %>

          <% if user_signed_in? %>
            <%= form_with model: [post, Comment.new], local: true do |f| %>
              <%= f.text_field :body,
                placeholder: "Write a comment...",
                class: "mt-2 w-full border rounded px-2 py-1 text-sm" %>
            <% end %>
          <% else %>
            <p class="text-sm text-gray-500 mt-2">Log in to comment.</p>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
